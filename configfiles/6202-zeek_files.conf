# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains processing steps for Zeek's files.log

# Reference: https://docs.zeek.org/en/master/scripts/base/frameworks/files/main.zeek.html#type-Files::Info

filter {
  if [type] == "zeek_files" and "zeek_json" in [tags] {
    mutate {
      rename => {
        "[raw][fuid]" => "fuid"
        "[raw][uid]" => "zeek_uid"
        "[raw][id.orig_h]" => "[source][ip]"
        "[raw][id.orig_p]" => "[source][port]"
        "[raw][id.resp_h]" => "[destination][ip]"
        "[raw][id.resp_p]" => "[destination][port]"
        "[raw][source]" => "source"
        "[raw][depth]" => "depth"
        "[raw][analyzers]" => "analyzers"
        "[raw][mime_type]" => "mime_types"
        "[raw][filename]" => "filename"
        "[raw][duration]" => "duration"
        "[raw][local_orig]" => "local_orig"
        "[raw][is_orig]" => "is_orig"
        "[raw][seen_bytes]" => "seen_bytes"
        "[raw][missing_bytes]" => "missing_bytes"
        "[raw][overflow_bytes]" => "overflow_bytes"
        "[raw][parent_fuid]" => "parent_fuid"
        "[raw][md5]" => "md5"
        "[raw][sha1]" => "sha1"
        "[raw][sha256]" => "sha256"
        "[raw][extracted]" => "extracted"
        "[raw][extracted_cutoff]" => "extracted_cutoff"
        "[raw][extracted_size]" => "extracted_size"
        "[raw][entropy]" => "entropy"
      }
    }

    # populate the @timestamp field with the ts value
    date {
      match => [ "[raw][ts]", "UNIX" ]
    }

    mutate {
      convert => {
        "depth" => "integer"
        "duration" => "float"
        "seen_bytes" => "integer"
        "[network][bytes]" => "integer"
        "missing_bytes" => "integer"
        "overflow_bytes" => "integer"
        "extracted_size" => "integer"
      }
      remove_field => "raw"
    }
  }
}
