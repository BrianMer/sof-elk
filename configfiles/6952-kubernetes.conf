# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file parses timestamp+KV-formatted Kubernetes logs

filter {
  if [type] == "kubernetes" {
    date {
      match => [ "timestamp", "ISO8601" ]
    }

    grok {
      match => [ "message", "^%{NOTSPACE}}%{SPACE}%{GREEDYDATA:message_remainder}" ]
    }

    mutate {
      replace => { "message" => "%{message_remainder}" }
    }
    mutate {
      # XXX must not be combined with replacement which uses same field
      remove_field => [ "message_remainder" ]
    }

### TODO: insert KV handling here



    mutate {
      remove_field => [ "message" ]
    }

  }
}
